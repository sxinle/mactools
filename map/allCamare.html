<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Hello, World</title>
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px
        }

        #container {
            height: 100%
        }
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=TKjIzns3qyTjZngvFx1SCL3GsGTlMI4O">
        //v2.0版本的引用方式：src="http://api.map.baidu.com/api?v=2.0&ak=TKjIzns3qyTjZngvFx1SCL3GsGTlMI4O"
        //v1.4版本及以前版本的引用方式：src="http://api.map.baidu.com/api?v=1.4&key=TKjIzns3qyTjZngvFx1SCL3GsGTlMI4O&callback=initialize"
    </script>
    <script src="setting.js"></script>
    <script src="lonlat.js"></script>
</head>

<body>
<div id="container"></div>
<script type="text/javascript">
    //--------------------------------------画地图设中心点---------------------------------------------------
    var map = new BMap.Map("container", {enableMapClick: false});                    // 创建地图实例,关闭Poi点击
    map.setMapStyle({styleJson: style});
    var point = new BMap.Point(117.192519, 39.112071);      // 创建点坐标
    map.centerAndZoom(point, 15);                           // 初始化地图，设置中心点坐标和地图级别

    // 比例尺改变,更改图标大小
    map.addEventListener("zoomend", zoomend);
    var zoomend = function (type, target) {
        var icon = map.getZoom() > 12 ? icon_camare : icon_camare_s;
        map.getOverlays().forEach(function (o) {
            if (o instanceof BMap.Marker) {
                o.setIcon(icon);
            }
        });
    }


    //--------------------------------------画控件----------------------------------------------------------
    var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件
    map.addControl(top_left_navigation);

    //--------------------------------------画POI点--------------------------------------------------------
    totalStreets.forEach(function (streetList) {
        streetList.forEach(function (street) {
            var point = new BMap.Point(street.lon, street.lat);
            var marker = new BMap.Marker(point, {icon: icon_camare_s});  // 创建标注
            marker.onclick = function () {
                showOverlay(point, street.addr, street.ip);
            }
            map.addOverlay(marker);                                 // 将标注添加到地图中
        })
    });


    //--------------------------------------画marker提示信息的自定义覆盖层--------------------------------------
    var markerOverlay;
    function showOverlay(point, pos, question) {
        hideOverlay();
        markerOverlay = new MarkerOverlay(point, pos, question);
        map.addOverlay(markerOverlay);
        hideOverlay = function () {
            map.removeOverlay(markerOverlay);
        };
    }

    // 创建控件
    var ranking = new TopRightRanking();
    // 添加到地图当中
    map.addControl(ranking);


    //--------------------------------------画行政区域--------------------------------------
    var colorRed = {strokeWeight: 4, strokeColor: "red", fillColor: "red", fillOpacity: 0.3};
    var colorGreen = {strokeWeight: 4, strokeColor: "green", fillColor: "green", fillOpacity: 0.3};
    for (var i = 0; i < totalOffices.length; i++) {
        var theme = i % 2 == 0 ? colorRed : colorGreen;

        var points = new Array();
        totalOffices[i].forEach(function (p) {
            points.push(new BMap.Point(p.lon, p.lat));
        })
        var polygon = new BMap.Polygon(points, theme); //建立多边形覆盖物

        polygon.addEventListener("click", polygonClick);

        map.addOverlay(polygon);  //添加覆盖物

    }

    function polygonClick() {
        alert(point);
    }


</script>

</body>
</html>

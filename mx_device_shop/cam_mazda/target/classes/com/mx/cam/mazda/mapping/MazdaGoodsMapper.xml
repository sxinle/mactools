<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mx.cam.mazda.dao.MazdaGoodsDao">

	<!-- 获取商品信息 -->
    <select id="getGoodsManage" resultType="com.mx.cam.mazda.model.Goods">
        select goods_id,
        	   c.catagory_name,
        	   g.goods_name,
        	   g.region_name,
        	   g.valid,
        	   g.nums,
        	   g.price,
        	   g.description,
        	   g.catagory_id,
        	   g.card_type,
               g.img_url,
               g.service_ids
        	   from mazda_goods g left join mazda_catagory c
        	   on g.catagory_id=c.catagory_id
        	   where 1=1
        <if test = "goods_id != null and goods_id != ''">
           and g.goods_id = #{goods_id}
        </if>
        <if test = "catagory_id != null and catagory_id != ''">
           and g.catagory_id = #{catagory_id}
        </if>
        <if test = "goods_name != null and goods_name != ''">
           and g.goods_name like "%"#{goods_name}"%"
        </if>
    </select>
        
    <!-- 删除某些商品信息 -->
    <delete id="deleteGoodsManage">
		delete from mazda_goods
		where goods_id in 
 		<foreach  item="item" collection="array" open="(" separator=","  close=")">
			#{item}
		</foreach>
	</delete>
	
	<!-- 根据商品Id俩检查商品是否重复 -->
	<select id="checkGoodsId" resultType="int">
        SELECT count(*) FROM mazda_goods where (goods_id = #{goods_id} or goods_name = #{goods_name})
        <if test = "id != null and id != ''">
           and goods_id != #{id}
        </if>
    </select>
    
    <!-- 保存商品信息 -->
    <insert id="saveGoods">
    	insert into mazda_goods(
    		goods_id,
    		catagory_id,
    		goods_name,
    		region_name,
    		valid,
    		nums,
    		price,
    		card_type,
    		description,
    		img_url,
    		service_ids
    	)
    	values(
    		#{goods_id},
    		#{catagory_id},
    		#{goods_name},
    		#{region_name},
    		#{valid},
    		#{nums},
    		#{price},
    		#{card_type},
    		#{description},
    		#{img_url},
    		#{service_ids}
    	)
    </insert>
    
    <!-- 修改商品信息 -->
    <update id="updateGoods">
    	update mazda_goods set 
    	goods_id = #{goods_id},
    	catagory_id = #{catagory_id},
    	goods_name = #{goods_name},
    	region_name = #{region_name},
    	valid = #{valid},
    	nums = #{nums},
    	price = #{price},
    	card_type=#{card_type},
    	description = #{description},
    	img_url = #{img_url},
    	service_ids = #{service_ids}
    	where goods_id = #{id}
    </update>
           
    <!-- 检查商品信息表中使用了哪些商品类别，以防止商品类别被删除 -->
	<select id="checkUsedByCatagoryId" resultType="int">
		select count(*) from mazda_goods
		where catagory_id in 
 		<foreach  item="item" collection="array" open="(" separator=","  close=")">
			#{item}
		</foreach>
	</select>
	
	<update id="updateGoodsCatagoryId">
		update mazda_goods set
		catagory_id = #{catagory_id}
		where catagory_id = #{id}
	</update>

    <select id="getGoods" resultType="com.mx.cam.mazda.model.Goods">
        select * from mazda_goods where catagory_id in
        <foreach  item="item" collection="array" open="(" separator=","  close=")">
            #{item}
        </foreach>
        order by catagory_id,goods_id
    </select>

    <select id="getGoodsById" resultType="com.mx.cam.mazda.model.Goods">
        select * from mazda_goods where goods_id in
        <foreach  item="item" collection="array" open="(" separator=","  close=")">
            #{item}
        </foreach>
    </select>

    <select id="getServiceGoods" resultType="com.mx.cam.mazda.model.Goods">
        select * from mazda_goods where service_ids is not null and service_ids != '';
    </select>

    <select id="getAllServices" resultType="com.mx.cam.mazda.model.GoodsService">
        select * from mazda_service;
    </select>

</mapper>
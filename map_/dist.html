<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>百日会展-成绩展示</title>
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px
        }

        #container {
            height: 100%
        }



    .axis path,
    .axis line,
    .line {
        stroke: #000;
        fill: none;
    }
    </style>


    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=TKjIzns3qyTjZngvFx1SCL3GsGTlMI4O">
    </script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="setting.js"></script>
    <script src="lonlat.js"></script>

</head>

<body>
<div id="container"></div>
<script type="text/javascript">
    //--------------------------------------画地图设中心点---------------------------------------------------
    var map = new BMap.Map("container", {enableMapClick: false});                    // 创建地图实例,关闭Poi点击
    map.setMapStyle({styleJson: style});
//    map.centerAndZoom(centers[2].center, 14);                           // 初始化地图，设置中心点坐标和地图级别
    map.centerAndZoom(new BMap.Point(117.201882,39.100868), 14);                           // 初始化地图，设置中心点坐标和地图级别

    // 比例尺改变,更改图标大小
    //    map.addEventListener("zoomend", zoomend);
    //    var zoomend = function (type, target) {
    //        var icon = map.getZoom() > 12 ? icon_camare : icon_camare_s;
    //        map.getOverlays().forEach(function (o) {
    //            if (o instanceof BMap.Marker) {
    //                o.setIcon(icon);
    //            }
    //        });
    //    }

    //--------------------------------------画控件----------------------------------------------------------
    var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件
    map.addControl(top_left_navigation);
    // 创建控件
    var ranking = new TopRightRanking();
    // 添加到地图当中
    map.addControl(ranking);


    //--------------------------------------画行政区域--------------------------------------
    function polygonClick(e) {
        polygons.forEach(function (p) {
            p.setFillOpacity(0.3);
        });
        var polygon = e.target;
        polygon.setFillOpacity(0.6);
        map.centerAndZoom(polygon.centerPoint.center);
        alert(polygon.centerPoint.desc);
    }

    // 画行政区
    var colorRed = {strokeWeight: 2, strokeColor: "red", fillColor: "red", fillOpacity: 0.3};
    var colorGreen = {strokeWeight: 2, strokeColor: "green", fillColor: "green", fillOpacity: 0.3};

    var polygons = [];


    for (var i = 0; i < totalOffices.length; i++) {
        var theme = i % 2 == 0 ? colorRed : colorGreen;
        var points = new Array();
        totalOffices[i].forEach(function (p) {
            points.push(new BMap.Point(p.lon, p.lat));
        })
        var polygon = new BMap.Polygon(points, theme); //建立多边形覆盖物
        polygon.centerPoint = centers[i];
        polygon.tagname = centers[i].desc;
        polygon.addEventListener("click", polygonClick);

        polygons.push(polygon);
        map.addOverlay(polygon);  //添加覆盖物
    }
    window.map = map;

    window.polygons = polygons;

    // 画行政区名称
    centers.forEach(function (e) {
        var center_p = e.center;
        var desc = e.desc;
        var opts = {
            position: center_p,    // 指定文本标注所在的地理位置
            offset: new BMap.Size(-30, -30)    //设置文本偏移量
        }
        var label = new BMap.Label(desc, opts);  // 创建文本标注对象
        label.setStyle({
            border: "none",
            color: "white",
            background: "transparent",
            fontSize: "12px",
            height: "20px",
            lineHeight: "20px",
            fontFamily: "微软雅黑"
        });

        map.addOverlay(label);
    });


    fillareas();





</script>

</body>
</html>
